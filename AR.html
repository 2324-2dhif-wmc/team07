<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        #debug-info {
            position: fixed;
            top: 0;
            left: 0;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px;
            z-index: 1000;
        }
    </style>
</head>
<body>
<div id="debug-info">Distance: N/A</div>

<script>
    // Request location permissions on page load
    window.onload = function() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    console.log('GPS permission granted', position);

                    // Initialize AR scene after permission is granted
                    initARScene();
                },
                function(error) {
                    console.error('Error requesting GPS permission', error);
                    alert('GPS permission is required to use this application.');
                }
            );
        } else {
            alert('Geolocation is not supported by this browser.');
        }
    };

    // Initialize AR scene
    function initARScene() {
        const scene = document.querySelector('a-scene');
        const textEntity = document.querySelector('#info-text');
        const debugInfo = document.querySelector('#debug-info');

        // Register component to check distance and update text visibility
        AFRAME.registerComponent('check-distance', {
            tick: function() {
                const camera = this.el.getObject3D('camera');
                const textPosition = textEntity.object3D.position;
                const cameraPosition = camera.position;

                // Calculate distance between camera and text entity
                const distance = cameraPosition.distanceTo(textPosition);

                debugInfo.innerHTML = 'Distance: ' + distance.toFixed(2);

                // Toggle text visibility based on distance
                if (distance <= 5) {
                    textEntity.setAttribute('visible', true);
                } else {
                    textEntity.setAttribute('visible', false);
                }
            }
        });

        // Add AR text entity to the scene
        textEntity.setAttribute('gps-entity-place', {
            latitude: 48.1435,
            longitude: 14.2356
        });

        // Initialize AR camera with minimum distance
        const camera = document.createElement('a-camera');
        camera.setAttribute('gps-camera', 'gpsMinDistance: 5');
        camera.setAttribute('rotation-reader', '');
        camera.setAttribute('check-distance', '');
        scene.appendChild(camera);
    }
</script>

<a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
>
    <a-text
            id="info-text"
            value="Stair"
            look-at="[gps-camera]"
            scale="10 10 10"
            visible="false"
    ></a-text>
</a-scene>

</body>
</html>
