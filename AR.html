<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        #debug-info {
            position: fixed;
            top: 0;
            left: 0;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px;
            z-index: 1000;
        }
    </style>
</head>
<body>
<div id="debug-info">1Distance: N/A</div>

<a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
>
    <a-text
            id="info-text"
            value="Stair"
            look-at="[gps-new-camera]"
            scale="10 10 10"
            gps-new-entity-place="latitude: 48.1435; longitude: 14.2356;"
            visible="false"
    ></a-text>
    <a-camera gps-new-camera="gpsMinDistance: 5" rotation-reader></a-camera>
</a-scene>

<script>
    AFRAME.registerComponent('check-distance', {
        init: function() {
            var textEntity = document.querySelector('#info-text');
            var debugInfo = document.querySelector('#debug-info');

            this.el.sceneEl.addEventListener('gps-camera-update-position', function(event) {
                var position = event.detail.position;
                console.log('Camera GPS position updated:', position);

                var distance = textEntity.components['gps-new-entity-place'].distance;
                console.log('Distance to entity:', distance);

                if (distance !== undefined) {
                    debugInfo.innerHTML = 'Distance: ' + distance;  // Update debug info on the screen

                    if (distance <= 5) {
                        textEntity.setAttribute('visible', 'true');
                    } else {
                        textEntity.setAttribute('visible', 'false');
                    }
                } else {
                    debugInfo.innerHTML = 'Distance: calculating...';
                }
            });
        }
    });

    document.querySelector('a-camera').setAttribute('check-distance', '');
</script>
</body>
</html>

